<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Horários de Recreio</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
<style>
body {
font-family: 'Open Sans', sans-serif;
margin: 0;
background: #f4f4f4;
display: flex;
justify-content: center;
min-height: 100vh;
overflow-y: scroll;
}

.main-wrapper {
background: white;
width: 100%;
max-width: 1000px;
padding: 20px;
box-shadow: 0 0 10px rgba(0,0,0,0.1);
margin: 20px 0;
}

.page-header {
text-align: center;
font-size: 1.8rem;
font-weight: bold;
margin-bottom: 30px;
color: #333;
}

.turnos-container {
display: flex;
gap: 40px;
justify-content: space-around;
}

.turno {
flex-basis: 50%;
min-width: 300px;
}

.turno-header {
font-size: 1.2rem;
font-weight: 600;
color: #4285f4;
margin-bottom: 30px; /* Aumentei o espaçamento para evitar sobreposição */
text-align: center;
padding: 5px 0;
border-bottom: 2px solid #ddd;
}

.timeline {
position: relative;
border-left: 2px solid #ddd;
padding-left: 45px;
padding-top: 20px; /* Adicionei padding superior para a primeira marca de tempo */
padding-bottom: 40px; /* Aumentei o padding inferior para a última marca de tempo */
height: 400px; 
box-sizing: content-box;
}

.time-slot {
position: absolute;
transform: translateY(-50%);
width: calc(100% - 45px);
}

.time-label {
position: absolute;
left: -40px;
font-size: 0.85rem;
color: #666;
font-weight: 600;
}

.event {
background: #eaf4ff;
padding: 8px 12px;
border-radius: 6px;
font-size: 0.9rem;
border-left: 4px solid #4285f4;
min-height: 40px;
display: flex;
align-items: center;
}

.current-time-line {
position: absolute;
left: 0;
right: 0;
height: 2px;
background: red;
z-index: 10;
display: none; /* Inicia oculto e só é exibido no horário correto */
}

.current-time-dot {
position: absolute;
left: -7px;
top: -4px;
width: 10px;
height: 10px;
background: red;
border-radius: 50%;
}

.current-time-label {
position: absolute;
left: -60px;
top: -14px;
font-size: 0.85rem;
font-weight: bold;
color: red;
background: #fff;
padding: 2px 4px;
border-radius: 4px;
box-shadow: 0 1px 3px rgba(0,0,0,0.15);
white-space: nowrap;
}

.countdown-label {
position: absolute;
right: -65px;
top: -14px;
font-size: 0.85rem;
font-weight: bold;
color: #000;
background: #fff;
padding: 2px 4px;
border-radius: 4px;
box-shadow: 0 1px 3px rgba(0,0,0,0.15);
white-space: nowrap;
}

/* Layout para Celular */
@media (max-width: 650px) {
	.main-wrapper {
		padding: 15px 10px;
		margin: 0;
		box-shadow: none;
	}
	.turnos-container {
		flex-direction: column;
		gap: 30px;
	}
	.turno {
		min-width: unset;
	}
	.timeline {
		height: auto;
		min-height: 350px;
	}
	.time-label {
		left: -30px;
		font-size: 0.75rem;
	}
	.current-time-label {
		left: -50px;
		font-size: 0.75rem;
		top: -11px;
	}
	.countdown-label {
		right: -50px;
		font-size: 0.75rem;
		top: -11px;
	}
}
</style>
</head>
<body>

<div class="main-wrapper">
<div class="page-header">Horários de Recreio</div>

<div class="turnos-container">
<div class="turno" id="turnoManha">
<div class="turno-header">Turno da Manhã (08:30 - 10:00)</div>
<div class="timeline" id="timelineManha" data-start-time="08:30" data-end-time="10:00">

<div class="current-time-line" id="currentTimeLineManha">
<div class="current-time-dot"></div>
<div class="current-time-label" id="currentTimeLabelManha">--:--:--</div>
<div class="countdown-label" id="countdownLabelManha">AGUARDANDO</div>
</div>

<div class="time-slot" data-time="08:30" data-event-type="start">
<span class="time-label">08:30</span>
<div class="event">Início Manhã (1º ao 2º ano EF)</div>
</div>
<div class="time-slot" data-time="08:55">
<span class="time-label">08:55</span>
<div class="event">6º ao 8º ano EF</div>
</div>
<div class="time-slot" data-time="09:15">
<span class="time-label">09:15</span>
<div class="event">3º ao 5º ano EF</div>
</div>
<div class="time-slot" data-time="09:45">
<span class="time-label">09:45</span>
<div class="event">9º ao 3º ano EM</div>
</div>
<div class="time-slot" data-time="10:00" data-event-type="end">
<span class="time-label">10:00</span>
<div class="event" style="background: #fff; color: #666; border-color: transparent;">Fim Turno</div>
</div>
</div>
</div>


<div class="turno" id="turnoTarde">
<div class="turno-header">Turno da Tarde (15:00 - 16:00)</div>
<div class="timeline" id="timelineTarde" data-start-time="15:00" data-end-time="16:00">

<div class="current-time-line" id="currentTimeLineTarde">
<div class="current-time-dot"></div>
<div class="current-time-label" id="currentTimeLabelTarde">--:--:--</div>
<div class="countdown-label" id="countdownLabelTarde">AGUARDANDO</div>
</div>

<div class="time-slot" data-time="15:00" data-event-type="start">
<span class="time-label">15:00</span>
<div class="event">Início Tarde (2º e 3º ano)</div>
</div>
<div class="time-slot" data-time="15:15">
<span class="time-label">15:15</span>
<div class="event">4º e 5º ano</div>
</div>
<div class="time-slot" data-time="15:45">
<span class="time-label">15:45</span>
<div class="event">6º ao 9º ano</div>
</div>
<div class="time-slot" data-time="16:00" data-event-type="end">
<span class="time-label">16:00</span>
<div class="event" style="background: #fff; color: #666; border-color: transparent;">Fim Tarde</div>
</div>
</div>
</div>
</div>
</div>

<script>
function timeToMinutes(time) {
const [h, m] = time.split(":").map(Number);
return h * 60 + m;
}

const allRecreios = [
{ start: "08:55", end: "09:10" },
{ start: "09:15", end: "09:30" },
{ start: "09:45", end: "10:00" },
{ start: "15:00", end: "15:15" },
{ start: "15:15", end: "15:30" },
{ start: "15:45", end: "16:00" }
];

// 1. Configura as posições iniciais dos eventos
function setTimeSlotPositions(timelineId) {
const timeline = document.getElementById(timelineId);
const startTime = timeToMinutes(timeline.getAttribute("data-start-time"));
const endTime = timeToMinutes(timeline.getAttribute("data-end-time"));
const totalMinutes = endTime - startTime;

timeline.querySelectorAll(".time-slot").forEach(slot => {
const time = timeToMinutes(slot.getAttribute("data-time"));

let percent = ((time - startTime) / totalMinutes) * 100;

// Usa um offset para levar em conta o padding superior/inferior da timeline
const PADDING_OFFSET = 5; 
percent = PADDING_OFFSET + percent * (100 - 2 * PADDING_OFFSET) / 100;

if (percent < 0) percent = 0;
if (percent > 100) percent = 100;

slot.style.top = percent + "%";
});
}

setTimeSlotPositions("timelineManha");
setTimeSlotPositions("timelineTarde");


// 2. Atualiza a linha do tempo e o cronômetro para um turno específico
function updateTurnoTimeline(idPrefix) {
const now = new Date();
const currentMinutesTotal = now.getHours() * 60 + now.getMinutes() + now.getSeconds() / 60;

const timelineElement = document.getElementById(`timeline${idPrefix}`);
const startTime = timeToMinutes(timelineElement.getAttribute("data-start-time"));
const endTime = timeToMinutes(timelineElement.getAttribute("data-end-time"));
const totalMinutes = endTime - startTime;

const line = document.getElementById(`currentTimeLine${idPrefix}`);
const label = document.getElementById(`currentTimeLabel${idPrefix}`);
const countdownLabel = document.getElementById(`countdownLabel${idPrefix}`);

// --------------------------------
// 2.1. Controle de Visibilidade
// --------------------------------

if (currentMinutesTotal < startTime || currentMinutesTotal > endTime) {
	// Oculta a linha e zera o contador se estiver fora do período
	line.style.display = 'none';
	// O label de horário só é atualizado se o turno estiver ativo
	label.textContent = "--:--:--"; 
	countdownLabel.textContent = "AGUARDANDO";
	return;
}

// Se chegou aqui, estamos DENTRO do turno
line.style.display = 'block';

// --------------------------------
// 2.2. Posicionamento e Horário Atual
// --------------------------------

let percent = ((currentMinutesTotal - startTime) / totalMinutes) * 100;

// Aplica o mesmo offset usado para os slots para alinhar a linha
const PADDING_OFFSET = 5;
percent = PADDING_OFFSET + percent * (100 - 2 * PADDING_OFFSET) / 100;

if (percent < 0) percent = 0;
if (percent > 100) percent = 100;

line.style.top = percent + "%";
label.textContent = now.toLocaleTimeString("pt-BR", { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });

// --------------------------------
// 2.3. Lógica do Cronômetro
// --------------------------------

let targetMinutes = null;
let isBreakActive = false;

// Filtra os recreios apenas para este turno
const turnoRecreios = allRecreios.filter(rec => {
	const start = timeToMinutes(rec.start);
	const end = timeToMinutes(rec.end);
	return start >= startTime && end <= endTime;
});


for (let rec of turnoRecreios) {
const start = timeToMinutes(rec.start);
const end = timeToMinutes(rec.end);

if (currentMinutesTotal < start) {
targetMinutes = start; // Contar até o INÍCIO do próximo recreio
break;
} else if (currentMinutesTotal >= start && currentMinutesTotal < end) {
targetMinutes = end; // Contar até o FIM do recreio atual
isBreakActive = true;
break;
}
}

if (targetMinutes !== null) {
	const diffMinutes = targetMinutes - currentMinutesTotal;
	const diffSeconds = Math.round(diffMinutes * 60); 

	if (diffSeconds > 0) {
		const mm = String(Math.floor(diffSeconds / 60)).padStart(2, "0");
		const ss = String(diffSeconds % 60).padStart(2, "0");
		const prefix = isBreakActive ? "RECREIO: -" : "AULA: -";
		countdownLabel.textContent = `${prefix}${mm}:${ss}`;
	} else {
		// Contagem regressiva chegou a zero (momento da transição)
		countdownLabel.textContent = isBreakActive ? "RECREIO AGORA!" : "PRÓXIMO RECREIO!";
	}
} else {
	// Não há mais recreios, mas o turno ainda não terminou
	countdownLabel.textContent = "FIM DOS RECREIOS";
}
}

// Função principal de atualização
function updateAllTimelines() {
updateTurnoTimeline("Manha");
updateTurnoTimeline("Tarde");
}

setInterval(updateAllTimelines, 1000);
updateAllTimelines();
</script>

</body>
</html>